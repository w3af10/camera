<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Logs</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'DM Sans',sans-serif;min-height:100vh;background:#08080d;color:#c8cad0;padding:24px}
        .header{max-width:900px;margin:0 auto 32px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px}
        h1{font-family:'Space Mono',monospace;font-size:1.3rem;color:#eef0f4;letter-spacing:-.5px}
        .header-right{display:flex;gap:10px;align-items:center}
        .count{font-family:'Space Mono',monospace;font-size:.8rem;color:#555869;background:rgba(255,255,255,.04);padding:6px 14px;border-radius:8px;border:1px solid rgba(255,255,255,.06)}
        .btn-sm{padding:8px 18px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);color:#a5b4fc;font-family:'DM Sans',sans-serif;font-size:.82rem;font-weight:600;cursor:pointer;transition:all .2s;text-decoration:none}
        .btn-sm:hover{background:rgba(255,255,255,.07);color:#c7d2fe}
        .btn-danger{border-color:rgba(239,68,68,.2);color:#f87171}
        .btn-danger:hover{background:rgba(239,68,68,.1)}

        .grid{max-width:900px;margin:0 auto;display:grid;gap:14px}

        .log-card{background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.05);border-radius:16px;padding:20px 24px;display:grid;grid-template-columns:auto 1fr auto;gap:16px;align-items:center;transition:all .3s;animation:fadeUp .4s ease backwards}
        .log-card:hover{border-color:rgba(56,100,220,.2);background:rgba(255,255,255,.04)}

        @keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

        .log-num{font-family:'Space Mono',monospace;font-size:1.1rem;font-weight:700;color:#3864dc;background:rgba(56,100,220,.08);width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center}

        .log-body{min-width:0}
        .log-coords{font-family:'Space Mono',monospace;font-size:.88rem;color:#eef0f4;font-weight:700;margin-bottom:4px;word-break:break-all}
        .log-meta{font-size:.78rem;color:#555869;display:flex;flex-wrap:wrap;gap:12px}
        .log-meta span{display:inline-flex;align-items:center;gap:4px}

        .log-actions{display:flex;flex-direction:column;gap:6px;align-items:flex-end}
        .map-btn{display:inline-flex;align-items:center;gap:5px;padding:7px 14px;border-radius:8px;background:rgba(56,100,220,.08);border:1px solid rgba(56,100,220,.15);color:#7c9bf7;font-size:.78rem;font-weight:600;text-decoration:none;transition:all .2s;white-space:nowrap}
        .map-btn:hover{background:rgba(56,100,220,.15);color:#a5b4fc}

        .log-time{font-family:'Space Mono',monospace;font-size:.72rem;color:#3a3d48;white-space:nowrap}

        .empty{text-align:center;padding:80px 20px;color:#3a3d48}
        .empty svg{margin-bottom:16px;opacity:.3}
        .empty p{font-size:.95rem}

        .raw-link{display:block;text-align:center;margin-top:32px;color:#3a3d48;font-size:.75rem;text-decoration:none}
        .raw-link:hover{color:#555869}

        .loading-spinner{display:flex;justify-content:center;padding:60px}
        .loading-spinner::after{content:'';width:32px;height:32px;border:3px solid rgba(255,255,255,.06);border-top-color:#3864dc;border-radius:50%;animation:spin .8s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}

        @media(max-width:600px){
            .log-card{grid-template-columns:1fr;gap:12px}
            .log-num{width:36px;height:36px;font-size:.9rem}
            .log-actions{flex-direction:row;align-items:center}
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì° Painel de Logs</h1>
        <div class="header-right">
            <span class="count" id="count">‚Äî registros</span>
            <button class="btn-sm" onclick="loadLogs()">‚Üª Atualizar</button>
            <a class="btn-sm" href="/log.json" target="_blank">{ } JSON</a>
            <button class="btn-sm btn-danger" onclick="clearLogs()">üóë Limpar</button>
        </div>
    </div>

    <div class="grid" id="grid">
        <div class="loading-spinner"></div>
    </div>

    <a class="raw-link" href="/log.json" target="_blank">Ver dados brutos em /log.json</a>

    <script>
        async function loadLogs() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '<div class="loading-spinner"></div>';

            try {
                const res = await fetch('/log.json');
                const logs = await res.json();

                document.getElementById('count').textContent = `${logs.length} registro${logs.length !== 1 ? 's' : ''}`;

                if (logs.length === 0) {
                    grid.innerHTML = `
                        <div class="empty">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                            <p>Nenhum log registrado ainda.</p>
                        </div>`;
                    return;
                }

                // Mostra do mais recente para o mais antigo
                grid.innerHTML = logs.slice().reverse().map((log, i) => {
                    const date = new Date(log.timestamp);
                    const formatted = date.toLocaleString('pt-BR');
                    const ago = timeAgo(date);

                    return `
                    <div class="log-card" style="animation-delay:${i * 0.05}s">
                        <div class="log-num">#${log.id}</div>
                        <div class="log-body">
                            <div class="log-coords">${log.latitude.toFixed(6)}, ${log.longitude.toFixed(6)}</div>
                            <div class="log-meta">
                                <span>üìè ¬±${Math.round(log.accuracy || 0)}m</span>
                                ${log.ip ? `<span>üåê ${log.ip}</span>` : ''}
                                <span>üïê ${ago}</span>
                            </div>
                        </div>
                        <div class="log-actions">
                            <a class="map-btn" href="${log.google_maps}" target="_blank">üìç Maps</a>
                            <span class="log-time">${formatted}</span>
                        </div>
                    </div>`;
                }).join('');

            } catch (err) {
                grid.innerHTML = '<div class="empty"><p>Erro ao carregar logs.</p></div>';
            }
        }

        async function clearLogs() {
            if (!confirm('Tem certeza que deseja apagar todos os logs?')) return;
            await fetch('/api/log', { method: 'DELETE' });
            loadLogs();
        }

        function timeAgo(date) {
            const s = Math.floor((Date.now() - date) / 1000);
            if (s < 60) return 'agora';
            if (s < 3600) return `${Math.floor(s / 60)}min atr√°s`;
            if (s < 86400) return `${Math.floor(s / 3600)}h atr√°s`;
            return `${Math.floor(s / 86400)}d atr√°s`;
        }

        // Auto-refresh a cada 10 segundos
        loadLogs();
        setInterval(loadLogs, 10000);
    </script>
</body>
</html>
