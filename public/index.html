<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificar Localiza√ß√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'DM Sans',sans-serif;min-height:100vh;display:flex;align-items:center;justify-content:center;background:#08080d;color:#c8cad0;padding:20px;overflow:hidden}
        body::before{content:'';position:fixed;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(ellipse at 20% 50%,rgba(56,100,220,.07) 0%,transparent 50%),radial-gradient(ellipse at 80% 20%,rgba(139,92,246,.05) 0%,transparent 50%);animation:bg 20s ease-in-out infinite alternate;z-index:-1}
        @keyframes bg{0%{transform:translate(0,0)}100%{transform:translate(-3%,3%)}}
        .container{text-align:center;max-width:440px;width:100%}
        .icon-wrap{display:inline-flex;align-items:center;justify-content:center;width:80px;height:80px;border-radius:50%;background:rgba(56,100,220,.08);margin-bottom:28px;position:relative}
        .icon-wrap::before{content:'';position:absolute;inset:-10px;border-radius:50%;border:1px solid rgba(56,100,220,.12);animation:ring 3s ease-in-out infinite}
        @keyframes ring{0%,100%{transform:scale(1);opacity:.8}50%{transform:scale(1.4);opacity:0}}
        .icon-wrap svg{width:34px;height:34px;stroke:#3864dc;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
        h1{font-family:'Space Mono',monospace;font-size:1.45rem;color:#eef0f4;margin-bottom:8px;letter-spacing:-.5px}
        .sub{color:#555869;font-size:.88rem;margin-bottom:36px;line-height:1.6}
        .btn{display:inline-flex;align-items:center;gap:10px;padding:15px 38px;background:linear-gradient(135deg,#3864dc,#6366f1);color:#fff;border:none;border-radius:14px;font-family:'DM Sans',sans-serif;font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s;box-shadow:0 4px 24px rgba(56,100,220,.3)}
        .btn:hover{transform:translateY(-2px);box-shadow:0 8px 32px rgba(56,100,220,.45)}
        .btn:active{transform:translateY(0)}
        .btn.loading{opacity:.55;pointer-events:none}
        .result{margin-top:32px;opacity:0;transform:translateY(20px);transition:all .5s;pointer-events:none}
        .result.show{opacity:1;transform:translateY(0);pointer-events:all}
        .card{background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.05);border-radius:18px;padding:24px;text-align:left}
        .card .row{display:flex;justify-content:space-between;align-items:center;padding:11px 0}
        .card .row+.row{border-top:1px solid rgba(255,255,255,.04)}
        .card .label{color:#555869;font-size:.83rem;font-weight:500}
        .card .value{color:#eef0f4;font-family:'Space Mono',monospace;font-size:.82rem;font-weight:700}
        .badge{display:inline-flex;align-items:center;gap:6px;margin-top:18px;padding:8px 16px;border-radius:100px;font-size:.78rem;font-weight:500;background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.18);color:#4ade80}
        .badge .dot{width:6px;height:6px;border-radius:50%;background:#4ade80;animation:blink 2s infinite}
        @keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
        .map-link{display:inline-flex;align-items:center;gap:8px;margin-top:14px;padding:10px 22px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:10px;color:#a5b4fc;text-decoration:none;font-weight:500;font-size:.88rem;transition:all .2s}
        .map-link:hover{background:rgba(255,255,255,.07);color:#c7d2fe}
        .err{margin-top:24px;padding:16px 20px;background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.13);border-radius:14px;color:#fca5a5;font-size:.88rem;display:none;line-height:1.5}
        .err.show{display:block}
        .foot{margin-top:40px;font-size:.72rem;color:#2a2d38}
        @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
    </style>
</head>
<body>
    <div class="container">
        <div class="icon-wrap">
            <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="2.5"/></svg>
        </div>
        <h1>Verificar Localiza√ß√£o</h1>
        <p class="sub">Toque no bot√£o para identificar sua posi√ß√£o atual com precis√£o via GPS</p>
        <button class="btn" id="btn" onclick="getLocation()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/></svg>
            Obter Localiza√ß√£o
        </button>
        <div class="result" id="result">
            <div class="card">
                <div class="row"><span class="label">Latitude</span><span class="value" id="lat">‚Äî</span></div>
                <div class="row"><span class="label">Longitude</span><span class="value" id="lng">‚Äî</span></div>
                <div class="row"><span class="label">Precis√£o</span><span class="value" id="acc">‚Äî</span></div>
                <div class="row"><span class="label">Data/Hora</span><span class="value" id="time">‚Äî</span></div>
            </div>
            <div><span class="badge"><span class="dot"></span>Dados registrados com sucesso</span></div>
            <div><a class="map-link" id="mapLink" href="#" target="_blank">üó∫Ô∏è Ver no Google Maps</a></div>
        </div>
        <div class="err" id="err"></div>
        <p class="foot">Seus dados de localiza√ß√£o s√£o processados de forma segura.</p>
    </div>

    <script>
        async function getLocation() {
            const btn = document.getElementById('btn');
            const result = document.getElementById('result');
            const err = document.getElementById('err');

            err.classList.remove('show');
            result.classList.remove('show');
            btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation:spin 1s linear infinite"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg> Obtendo...';
            btn.classList.add('loading');

            if (!navigator.geolocation) { showErr('Seu navegador n√£o suporta geolocaliza√ß√£o.'); return; }

            navigator.geolocation.getCurrentPosition(async (pos) => {
                const { latitude, longitude, accuracy, altitude, speed } = pos.coords;
                const now = new Date().toLocaleString('pt-BR');

                document.getElementById('lat').textContent = latitude.toFixed(6);
                document.getElementById('lng').textContent = longitude.toFixed(6);
                document.getElementById('acc').textContent = `¬±${Math.round(accuracy)}m`;
                document.getElementById('time').textContent = now;
                document.getElementById('mapLink').href = `https://www.google.com/maps?q=${latitude},${longitude}`;

                // Envia para o servidor
                try {
                    await fetch('/api/log', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ latitude, longitude, accuracy, altitude, speed })
                    });
                } catch (e) {
                    console.error('Erro ao enviar log:', e);
                }

                result.classList.add('show');
                resetBtn();
            }, (e) => {
                const msgs = { 1: 'Permiss√£o negada. Permita o acesso √† localiza√ß√£o.', 2: 'N√£o foi poss√≠vel determinar a localiza√ß√£o.', 3: 'Tempo esgotado.' };
                showErr(msgs[e.code] || 'Erro desconhecido.');
            }, { enableHighAccuracy: true, timeout: 15000 });
        }

        function showErr(msg) {
            const err = document.getElementById('err');
            err.textContent = msg;
            err.classList.add('show');
            resetBtn();
        }

        function resetBtn() {
            const btn = document.getElementById('btn');
            btn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/></svg> Obter Localiza√ß√£o';
            btn.classList.remove('loading');
        }
    </script>
</body>
</html>
